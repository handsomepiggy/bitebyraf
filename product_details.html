<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Product Details - bitesbyraf</title>
  <link rel="stylesheet" href="styles.css">

  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
</head>
<body>

<header>
  <nav>
    <a href="index.html" class="logo-container">
      <img src="images/logo.png" alt="bitesbyraf Logo" class="logo-img">
      <span class="logo-text">bitesbyraf</span>
    </a>
    <div class="nav-links">
      <a href="product_list.html"><img src="images/icon-products.png" alt="Products" class="nav-icon"></a>
      <a href="cart.html" style="position: relative;">
        <img src="images/icon-cart.png" alt="Cart" class="nav-icon">
        <span id="cart-count" class="cart-badge" style="display:none;">0</span>
      </a>
      <a href="admin.html"><img src="images/icon-admin.png" alt="Admin" class="nav-icon"></a>
    </div>
  </nav>
</header>

<div class="container" id="details-content">
  <a href="product_list.html" style="text-decoration:none; color: var(--primary-text); font-weight:bold;">‚Üê Back to Menu</a>
  
  <div class="two-col" style="margin-top: 30px;">
    <div>
      <img id="det-image" src="images/products/placeholder.png" alt="Loading..." style="width:100%; border-radius:15px; box-shadow: 0 10px 20px rgba(0,0,0,0.1); min-height: 300px; object-fit: cover;">
    </div>

    <div style="padding: 20px;">
      <span id="det-category" style="text-transform: uppercase; color: var(--primary-pink); font-weight: bold; letter-spacing: 1px;">Category</span>
      <h1 id="det-name" style="font-family: 'Playfair Display', serif; font-size: 2.5rem; margin: 10px 0;">Loading Product...</h1>
      <p id="det-price" style="font-size: 1.5rem; font-weight: bold; color: #333; margin-bottom: 20px;">RM 0.00</p>
      
      <div style="border-top: 1px solid #eee; padding-top: 20px;">
        <h3 style="font-family: 'Playfair Display', serif;">Description</h3>
        <p id="det-long-desc" style="line-height: 1.6; color: #666; margin-bottom: 30px; white-space: pre-line;">
          Please wait while we fetch the details...
        </p>
      </div>

      <div id="det-button-container">
          </div>
    </div>
  </div>
</div>

<div id="toast-box"></div>

<script src="app.js"></script>

<script>
// We use a small delay or check to ensure 'db' from app.js is initialized
const loadProductDetails = async () => {
    const params = new URLSearchParams(window.location.search);
    const productId = params.get('id');

    if (!productId) {
        console.error("No product ID found in URL");
        window.location.href = "product_list.html";
        return;
    }

    // Ensure Firebase is initialized (checking db from app.js)
    if (typeof db === 'undefined') {
        console.log("Waiting for Firebase...");
        setTimeout(loadProductDetails, 500);
        return;
    }

    try {
        const doc = await db.collection('products').doc(productId).get();

        if (doc.exists) {
            const p = doc.data();

            document.getElementById('det-image').src = p.image || 'images/products/placeholder.png';
            document.getElementById('det-name').textContent = p.name;
            document.getElementById('det-price').textContent = `RM ${parseFloat(p.price).toFixed(2)}`;
            document.getElementById('det-category').textContent = p.category;
            
            // Inject long description (preserves line breaks)
            document.getElementById('det-long-desc').textContent = p.longDesc || p.shortDesc || "Baked fresh with premium ingredients.";

            document.getElementById('det-button-container').innerHTML = `
                 <button onclick="addToCart('${doc.id}', '${p.name}', ${p.price})" class="btn">
                      Add to Cart üõí
                 </button>`;
                 
            document.title = `${p.name} - bitesbyraf`;
        } else {
            document.getElementById('details-content').innerHTML = `
                <div style="text-align:center; padding: 100px 20px;">
                    <h2 style="font-family: 'Playfair Display', serif;">Oops! Treat Not Found</h2>
                    <p>The product might have been removed or moved.</p>
                    <br>
                    <a href="product_list.html" class="btn">Back to Menu</a>
                </div>`;
        }
    } catch (error) {
        console.error("Error loading product details:", error);
        document.getElementById('det-name').textContent = "Error Loading Details";
    }
};

window.onload = loadProductDetails;
</script>

</body>
</html>